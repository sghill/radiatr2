<!DOCTYPE HTML>
<html>
	<head>
	  <script type="text/javascript" src="js/jquery/1.5.2/jquery.min.js"></script>
	  <script type="text/javascript" src="js/handlebars/0.9.0.pre/handlebars.js"></script>
	
	  <script id="jobs-template" type="text/x-handlebars-template">
			<ol class="jobs">
				{{#each jobs}}
					<li><a href="{{url}}api/json" class="{{color}}" onclick="javascript:renderer.builds.get(this.href); return false;">{{name}}</a></li>
				{{/each}}
			</ol>
		</script>
		
		<script id="builds-template" type="text/x-handlebars-template">
			<ol class="builds">
				{{#each builds}}
					<li>Build Number: {{number}} <a href="{{url}}api/json" onclick="javascript:renderer.build_details.get(this.href); return false;">details</a></li>
				{{/each}}
			</ol>
		</script>
		
		<script id="build-details-template" type="text/x-handlebars-template">
			<div class="builds-details">
			  Build Number: {{number}}<br/>
				Build Name: {{fullDisplayName}}<br/>
				Result: {{result}}<br/>
			</div>
		</script>	
	</head>
	<body>
		<script type="text/javascript">
		
			$(document).ready(function() {
				renderer = new BM.Renderers();
				renderer.jobs.get("http://build.expenselynx.com:8080/api/json");
			});
			
			var BM = BM || {};
			
			BM.Utils = function (options) {
				return {
					getJSONP : function(url, callback) {
						$.getJSON(url + "?jsonp=?", function(response) {
							callback(response);
						});
					}
			  };
			};
			
			BM.JenkinsItemRenderer = function (options) {
				var template_id = options.template_id;
				var placeholder_id = options.placeholder_id;
				var utils = new BM.Utils();
				
			  return {
					get : function(url) {
						console.debug('BM.JenkinsItemRenderer get url:' + url);
						utils.getJSONP(url, this.load);
					},
					load : function(data) {
						console.debug('BM.JenkinsItemRenderer load data:' + data);
						console.debug(data);
						var source = $(template_id).html();
						var template = Handlebars.compile(source);
						var html = template(data);
						
						$(placeholder_id).html(html);
					}
			  };
			};
			
			BM.Renderers = function () {
				return {
					jobs : new BM.JenkinsItemRenderer({
						template_id:"#jobs-template",
						placeholder_id:"div.jobs"
					}),
					builds : new BM.JenkinsItemRenderer({
						template_id:"#builds-template",
						placeholder_id:"div.builds"
					}),
					build_details : new BM.JenkinsItemRenderer({
						template_id:"#build-details-template",
						placeholder_id:"div.build-details"
					})
			  };
			};
		</script>
		<div class="jobs"></div>
		<div class="builds"></div>
		<div class="build-details"></div>
	</body>
</html>

<!-- {
    "actions": [{
        "causes": [{
            "shortDescription": "Started by an SCM change"
        }]
    }, {}, {
        "buildsByBranchName": {
            "origin/master": {
                "buildNumber": 8,
                "buildResult": null,
                "revision": {
                    "SHA1": "76f905ad461c2c555a29710c1f6c493259b5b7f3",
                    "branch": [{
                        "SHA1": "76f905ad461c2c555a29710c1f6c493259b5b7f3",
                        "name": "origin/master"
                    }]
                }
            }
        },
        "lastBuiltRevision": {
            "SHA1": "76f905ad461c2c555a29710c1f6c493259b5b7f3",
            "branch": [{
                "SHA1": "76f905ad461c2c555a29710c1f6c493259b5b7f3",
                "name": "origin/master"
            }]
        }
    }, {}],
    "artifacts": [],
    "building": false,
    "description": null,
    "duration": 7513,
    "fullDisplayName": "akiellor - objectify #8",
    "id": "2011-03-14_03-39-36",
    "keepLog": false,
    "number": 8,
    "result": "SUCCESS",
    "timestamp": 1300073976000,
    "url": "http://build.expenselynx.com:8080/job/akiellor%20-%20objectify/8/",
    "builtOn": "",
    "changeSet": {
        "items": [{
            "author": {
                "absoluteUrl": "http://build.expenselynx.com:8080/user/Andrew%20Kiellor",
                "fullName": "Andrew Kiellor"
            },
            "comment": "Bumped version to 0.0.3\n",
            "date": "2011-03-14 03:38:18 +1100",
            "id": "76f905ad461c2c555a29710c1f6c493259b5b7f3",
            "msg": "Bumped version to 0.0.3",
            "paths": [{
                "editType": "edit",
                "file": "lib/objectify/version.rb"
            }]
        }],
        "kind": null
    },
    "culprits": [{
        "absoluteUrl": "http://build.expenselynx.com:8080/user/Andrew%20Kiellor",
        "fullName": "Andrew Kiellor"
    }]
} -->